(function(a,b){var c={id:1};b.Calendar=function(a){this.initialize(a)},b.Calendar.prototype={initialize:function(b){this._setOptions(b),this._calendarId="uiCalendar_"+c.id++,typeof this._options.target=="string"?this._options.target=a("#"+this._options.target):this._options.target=a(this._options.target),this._createFrame(),this._container=a("#"+this._calendarId+" tbody"),this._compareDate="no",this._options.setDate!==null?(this._options.year=this._options.setDate.getFullYear(),this._options.month=this._options.setDate.getMonth()+1):(this._options.year=(new Date).getFullYear(),this._options.month=(new Date).getMonth()+1),this._options.minDate!==0&&this._options.maxDate!==0?this._compareDate="between":this._options.minDate!==0?this._compareDate="less":this._options.maxDate!==0&&(this._compareDate="more"),this._draw()},_setOptions:function(b){this._options={setDate:null,minDate:0,maxDate:0,popup:!1,target:null,onSelect:null,dateFormat:"default"},a.extend(this._options,b)},_nowMonth:function(){this._draw(new Date)},_preMonth:function(){this._draw(new Date(this._options.year,this._options.month-2,1))},_nextMonth:function(){this._draw(new Date(this._options.year,this._options.month,1))},_preYear:function(){this._draw(new Date(this._options.year-1,this._options.month-1,1))},_nextYear:function(){this._draw(new Date(this._options.year+1,this._options.month-1,1))},_draw:function(b){arguments.length===1&&(this._options.year=b.getFullYear(),this._options.month=b.getMonth()+1);var c=[],d=[],e,f,g,h=new Date,i,j,k,l=l=(new Date(this._options.year,this._options.month-1,1)).getDay(),m=(new Date(this._options.year,this._options.month,0)).getDate(),n=document.createDocumentFragment();for(i=1;i<=l;i++)c.push(0);for(i=1;i<=m;i++)c.push(i);while(c.length){e=document.createElement("tr");for(i=1;i<=7;i++)f=document.createElement("td"),c.length&&(g=c.shift(),g&&(d[g]=f,j=new Date(this._options.year,this._options.month-1,g),this._isSame(j,h)&&this._onToday(f),this._setDate(j,f),k=document.createElement("a"),k.href="javascript:void(0);",k.innerHTML=g,f.appendChild(k))),e.appendChild(f);n.appendChild(e)}this._container.html(n),a("#"+this._calendarId+" .year").html(this._options.year),a("#"+this._calendarId+" .month").html(this._options.month)},_isSame:function(a,b){return a.getFullYear()==b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()},_setDate:function(a,b){var c=this,d=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),e=!1;switch(this._compareDate){case"less":d-c._options.minDate>=0||(e=!0,c._setUnavailable(b));break;case"between":c._options.minDate-d<0&&c._options.maxDate-d>0||(e=!0,c._setUnavailable(b));break;case"more":d-c._options.maxDate<=0||(e=!0,c._setUnavailable(b))}this._options.setDate!==null&&this._isSame(a,this._options.setDate)&&(e===!0?alert("\u4f60\u8f93\u5165\u7684\u65e5\u671f\u8d85\u51fa\u53ef\u9009\u8303\u56f4"):this._onSelectDay(b))},_setUnavailable:function(b){a(b).addClass("disable")},_onSelectDay:function(b){a(b).addClass("select")},_onToday:function(b){a(b).addClass("today")},_createFrame:function(){var b=document.createElement("div"),c='<div class="ui_calendar_hd">';c+='<a href="javascript:;" class="pre_y">&lt;&lt;</a> ',c+='<a href="javascript:;" class="pre_m">&lt;</a> ',c+='<a href="javascript:;" class="next_y">&gt;&gt;</a>',c+='<a href="javascript:;" class="next_m">&gt;</a> ',c+='<span class="calendar_title"><span class="year"></span>\u5e74<span class="month"></span>\u6708</span>',c+="</div>",c+="<table>",c+='<thead><tr><td class="weekend">\u65e5</td><td>\u4e00</td><td>\u4e8c</td><td>\u4e09</td><td>\u56db</td><td>\u4e94</td><td class="weekend">\u516d</td></tr></thead>',c+="<tbody></tbody>",c+="</table>",b.className="ui_calendar",b.id=this._calendarId,b.innerHTML=c;var d=this._options.target;this._options.popup===!0&&(b.style.display="none"),this._options.popup===!0?d!==null?(document.body.appendChild(b),this.setPopupPosition()):alert("\u8bf7\u8bbe\u7f6etarget\u53c2\u6570"):d!==null?d.append(b):document.body.appendChild(b);var e=this;a(b).delegate("a","click",function(b){var c=this;switch(this.className){case"pre_m":e._preMonth();break;case"next_m":e._nextMonth();break;case"pre_y":e._preYear();break;case"next_y":e._nextYear();break;default:if(c.parentNode.className==="disable")break;var d=new Date(e._options.year,e._options.month-1,c.innerHTML);e.selectDate(d);if(e._options.popup===!0){var f=e._options.target,g=e._options.dateFormat;f.is("input")?f.attr("value",e.getDate(g)):f.html(e.getDate(g)),a("#"+e._calendarId).hide()}}return!1})},setPopupPosition:function(){var b=this._options.target,c="#"+this._calendarId;b.click(function(b){b.stopPropagation();var d=a(this).offset();a(c).css({left:d.left,top:d.top+25,position:"absolute",display:"block"})}),a("body").click("click",function(b){a(c).hide()}),a(c).click(function(a){a.stopPropagation()})},hide:function(){a("#"+this._calendarId).hide()},show:function(){a("#"+this._calendarId).show()},selectDate:function(a){this._options.setDate=a,this._draw(a),typeof this._options.onSelect=="function"&&this._options.onSelect.call(this)},getDate:function(a){if(this._options.setDate===null)return!1;var b=this._options.setDate,c="",d=b.getFullYear(),e=b.getMonth()+1,f=b.getDate();return a==="fullDate"?c=d+"\u5e74"+e+"\u6708"+f+"\u65e5":c=d+"/"+e+"/"+f,c},remove:function(){a("#"+this._calendarId).remove()}}})(jQuery,window)
