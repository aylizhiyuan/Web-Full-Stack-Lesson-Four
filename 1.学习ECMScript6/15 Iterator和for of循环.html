<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
</html>
<script>
    //遍历器Iterator是一个借口，为各种不同的数据结构提供统一的遍历机制
    //判断一个数据类型是否可以被遍历，是通过检查有没有Symbol.iterator属性
    //凡是部署了Symbol.iterator属性的数据结构，就成为部署了遍历器的接口
    //调用这个接口，就会返回一个遍历器的对象

    //当使用for of循环遍历某种数据结构的时候,该循环会自动的寻找Iterator接口

    const obj = {
        //Symbol.iterator是属性，对应的是一个函数
        [Symbol.iterator]:function(){
            return {
                next:function(){
                    return {
                        value:1,
                        done:false
                    }
                }
            }
        }
    }

    //数组、某些类似数组的对象、Set和Map具备遍历器接口
    let arr = ['a','b','c'];
    let iter = arr[Symbol.iterator]();
    iter.next();
    iter.next();iter.next() // { value: 'a', done: false }
    iter.next() // { value: 'b', done: false }
    iter.next() // { value: 'c', done: false }
    iter.next() // { value: undefined, done: true }

    //最简单的是可以通过for of方法完成遍历
    //如果没有部署，那么就需要自己去写Symbol.iterator方法

    //类添加Symbol.iterator方法的例子
    class RangeIterator {
        constructor(start,stop){
            this.value = start;
            this.stop = stop;
        }
        [Symbol.iterator](){return this}
        next(){
            var value = this.value;
            if (value < this.stop) {
                this.value++;
                return {done: false, value: value};
            } else {
                return {done: true, value: undefined};
            }
        }
    }
    function range (start,stop){
        return new RangeIterator(start,stop);
    }
    for(var value of range(0,3)){
        console.log(value);
    }

    //在对象中添加接口的例子
    let obj = {
        data: [ 'hello', 'world' ],
        [Symbol.iterator]() {
            const self = this;
            let index = 0;
            return {
                next() {
                    if (index < self.data.length) {
                        return {
                            value: self.data[index++],
                            done: false
                        };
                    } else {
                        return { value: undefined, done: true };
                    }
                }
            };
        }
    };

    //类数组的调用例子
    let iterable = {
        0: 'a',
        1: 'b',
        2: 'c',
        length: 3,
        [Symbol.iterator]: Array.prototype[Symbol.iterator]
    };
    for (let item of iterable) {
        console.log(item); // 'a', 'b', 'c'
    }

    //字符串的接口
    var str = new String("hi");

    [...str] // ["h", "i"]

    str[Symbol.iterator] = function() {
        return {
            next: function() {
                if (this._first) {
                    this._first = false;
                    return { value: "bye", done: false };
                } else {
                    return { done: true };
                }
            },
            _first: true
        };
    };

    [...str] // ["bye"]
    str // "hi"





</script>